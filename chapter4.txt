This is first version of chapter 4. We put it on master branch